# import sys
# sys.path.append("../")
import ray_py # do pip install [-e] first
from mpi4py import MPI
import numpy as np

def test_cpp_defaults():
    depths = ray_py.calc_test_depths()

    comm = MPI.COMM_WORLD
    rank = comm.Get_rank()

    if rank==0:
        check_depths = np.loadtxt("./pos.out",usecols=3)
        assert np.allclose(depths,check_depths,atol=1.e-7,rtol=0)

def test_passed_defaults() :
    comm = MPI.COMM_WORLD
    rank = comm.Get_rank()

    np.random.seed(42)
    r = np.random.random((100,3))
    h = np.random.random(100)
    op = np.ones(100)

    tau=ray_py.calc_depths(r,h,op)
    if rank==0:
        result = np.array([ 268.2822892 ,    6.50488805,   45.81952549,  113.34330112,
         32.60233843,   50.4779253 ,   59.6734217 ,    5.64776793,
         46.59373265,   20.63587445,    6.777879  ,  129.88069597,
         77.29865818,   63.8707159 ,   55.75907382,   46.21809421,
        118.92886296,  293.85018746,   62.24717229,    2.07482661,
         86.26804326,   43.30654766,   14.19904977,  149.1849586 ,
         62.89505113,   57.0194513 ,   73.33889597,   11.08663848,
         68.46246053,   68.83570901,   51.72198045,   58.36711089,
         28.56127912,   31.23339313, 1072.13723096,   78.32449524,
         20.39300374,  120.08088064,  229.97988753,  282.30874036,
         75.06648573,    5.0494384 ,   71.44312213,   14.67428175,
         53.82474632,   54.38882209,   93.84145971,   32.98742693,
         37.62256893,    6.37499616,   39.88722604,   50.73882975,
         54.82182902,   79.96052725,   50.56994432,   31.79406767,
         48.86129026,    4.4215439 ,  116.24157452,   24.51067496,
         83.40896023,   72.17929043,   66.14918177,  123.62363235,
         89.0695824 ,   79.97842016,  121.23062452,   59.291587  ,
          9.7591412 ,   47.47139002,   82.33548204,   37.44259127,
         69.16152232,   74.69199732,   12.42795668,   56.78286122,
        133.01433431,   69.3108461 ,   44.32833177,    9.25428236,
        143.49511782,   72.78960258,  134.42081103,   63.45768007,
         32.63852972,   92.74499586,   62.53446293,   51.69328349,
         94.41904948,   54.48258383,  130.02447401,   69.28840856,
         89.10519515,   71.81454684,   43.41703173,   39.89942215,
         15.23787555,   35.23634308,   44.43162379,    6.57825513])
        assert np.allclose(tau, result, atol=1.e-7, rtol=0)
